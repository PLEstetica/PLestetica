Guía de Implementación: Sincronización con Google Sheets
Sigue estos pasos para conectar tu aplicación de turnos con una hoja de cálculo de Google.

Paso 1: Crear la Hoja de Cálculo
1. Ve a Google Sheets y crea una nueva hoja en blanco.
2. Ponle un nombre, por ejemplo: "Turnos PL Estética".
3. Ve al menú Extensiones > Apps Script.

Paso 2: Configurar el Script
1. Se abrirá una nueva pestaña con el editor de código.
2. Borra todo el código que aparece por defecto.
3. Copia y pega el siguiente código:

function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName("Turnos");
    if (!sheet) {
      sheet = ss.insertSheet("Turnos");
      setupSheet(sheet);
    }
    
    const data = JSON.parse(e.postData.contents);
    
    // Check if it's a test connection
    if (data.type === 'test') {
      return ContentService.createTextOutput(JSON.stringify({ 
        status: 'success', 
        message: 'Conexión exitosa' 
      })).setMimeType(ContentService.MimeType.JSON);
    }

    let receiptLink = "";
    if (data.receipt) {
      try {
        const folderName = "Comprobantes PL Estetica";
        let folder;
        const folders = DriveApp.getFoldersByName(folderName);
        if (folders.hasNext()) {
          folder = folders.next();
        } else {
          folder = DriveApp.createFolder(folderName);
        }

        const parts = data.receipt.split(',');
        const contentType = parts[0].split(':')[1].split(';')[0];
        const decodedData = Utilities.base64Decode(parts[1]);
        const blob = Utilities.newBlob(decodedData, contentType, data.receiptName || "comprobante.png");
        
        const file = folder.createFile(blob);
        file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
        receiptLink = file.getUrl();
      } catch (fError) {
        receiptLink = "Error: " + fError.toString();
      }
    }

    const row = [
      new Date(), // Timestamp
      data.id,
      data.date,
      data.time,
      data.client.name,
      data.client.email,
      data.client.phone,
      data.services.join(', '),
      data.duration,
      data.price,
      receiptLink,
      data.status
    ];
    sheet.appendRow(row);
    
    return ContentService.createTextOutput(JSON.stringify({ 
      status: 'success', 
      id: data.id 
    })).setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({ 
      status: 'error', 
      message: error.toString() 
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet() {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName("Turnos");
    if (!sheet) return ContentService.createTextOutput(JSON.stringify([])).setMimeType(ContentService.MimeType.JSON);
    
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const rows = data.slice(1);
    
    const bookings = rows.map(row => {
      let booking = {};
      headers.forEach((header, i) => {
        booking[header.toLowerCase().replace(/ /g, '_')] = row[i];
      });
      return booking;
    });
    
    return ContentService.createTextOutput(JSON.stringify(bookings)).setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({error: error.toString()})).setMimeType(ContentService.MimeType.JSON);
  }
}

function setupSheet(specificSheet) {
  const sheet = specificSheet || SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const headers = ['Timestamp', 'ID Reserva', 'Fecha', 'Hora', 'Cliente', 'Email', 'Teléfono', 'Servicios', 'Duración (min)', 'Precio', 'Comprobante', 'Estado'];
  
  if (sheet.getLastRow() === 0) {
    sheet.appendRow(headers);
    sheet.getRange(1, 1, 1, headers.length).setFontWeight('bold').setBackground('#8c9d6e').setFontColor('white');
  }
}

Paso 3: Desplegar como Aplicación Web
1. Haz clic en el botón Implementar (arriba a la derecha) > Nueva implementación.
2. En "Seleccionar tipo", elige Aplicación web.
3. Ejecutar como: "Yo".
4. Quién tiene acceso: "Cualquier persona" (IMPORTANTE).
5. Haz clic en Implementar y copia la URL que termina en /exec.

Paso 4: Configurar en la App
1. Ve a Admin > Configuración y pega la URL en "URL Google Script".
2. Guarda los cambios.
3. ¡LISTO! Ahora tus turnos se guardarán automáticamente y podrás sincronizarlos.